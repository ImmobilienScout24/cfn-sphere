machine:
  python:
    version: 2.7.5
dependencies:
  pre:
    - "gem install package_cloud fpm"
    - "pip install --upgrade pip"
    - "pip install pybuilder"
    - "pyb install_dependencies"
    - "sudo apt-get install rpm"
    - "rpm --initdb --dbpath /tmp"
test:
  override:
    - "pyb run_unit_tests"
  post:
    - cp -R target/reports $CIRCLE_ARTIFACTS
deployment:
  production:
    branch: stable
    commands:
      - "pyb"
      - "cd target/dist/* && fpm --iteration $CIRCLE_BUILD_NUM --python-install-lib '/usr/lib/python2.7/site-packages' -s python -t rpm setup.py"
      - "cd target/dist/* && fpm --iteration $CIRCLE_BUILD_NUM --python-install-lib '/usr/lib/python2.7/site-packages' -s python -t deb setup.py"
      - "package_cloud push marco-hoyer/cfn-sphere/scientific/6 target/dist/*/*.rpm"
      - "package_cloud push marco-hoyer/cfn-sphere/debian/wheezy target/dist/*/*.deb"
      - "package_cloud push marco-hoyer/cfn-sphere/debian/jessie target/dist/*/*.deb"
