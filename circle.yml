machine:
  python:
    version: 2.7.5
dependencies:
  pre:
    - "gem install package_cloud fpm"
    - "pip install --upgrade pip"
    - "pip install pybuilder"
    - "pyb install_dependencies"
    - "sudo apt-get install rpm"
    - "rpm --initdb --dbpath /.rpmdb"
test:
  override:
    - "pyb run_unit_tests"
  post:
    - cp -R target/reports $CIRCLE_ARTIFACTS
deployment:
  production:
    branch: master
    commands:
      - "pyb"
      - "cd target/dist/* && python setup.py bdist_rpm"
      - "package_cloud push marco-hoyer/cfn-sphere/scientific/6 $(basename $(ls target/dist/*/dist/*.rpm | grep -v 'src.rpm'))"