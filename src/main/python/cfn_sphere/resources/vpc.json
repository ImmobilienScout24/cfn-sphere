{
        "AWSTemplateFormatVersion":"2010-09-09",
        "Description":"AWS CloudFormation Template for a VPC in eu-west-1 with 3 subnets, one per AZ",
        "Mappings":{
                "SubnetConfig":{
                        "VPC-Values":{
                                "CIDR":"10.41.0.0/16"
                        },
                        "SubnetA-Values":{
                                "CIDR":"10.41.0.0/18",
                                "AZ":"us-east-1a"
                        },
                        "SubnetB-Values":{
                                "CIDR":"10.41.64.0/18",
                                "AZ":"us-east-1b"
                        },
                        "SubnetC-Values":{
                                "CIDR":"10.41.128.0/18",
                                "AZ":"us-east-1d"
                        }
                }
        },
        "Resources":{
                "VPC":{
                        "Type":"AWS::EC2::VPC",
                        "Properties":{
                                "EnableDnsSupport":"true",
                                "EnableDnsHostnames":"true",
                                "CidrBlock":{
                                        "Fn::FindInMap":[
                                                "SubnetConfig",
                                                "VPC-Values",
                                                "CIDR"
                                        ]
                                },
                                "Tags":[
                                        {
                                                "Key":"Application",
                                                "Value":{
                                                        "Ref":"AWS::StackName"
                                                }
                                        }
                                ]
                        }
                },
                "SubnetA":{
                        "Type":"AWS::EC2::Subnet",
                        "Properties":{
                                "AvailabilityZone":{
                                        "Fn::FindInMap":[
                                                "SubnetConfig",
                                                "SubnetA-Values",
                                                "AZ"
                                        ]
                                },
                                "VpcId":{
                                        "Ref":"VPC"
                                },
                                "CidrBlock":{
                                        "Fn::FindInMap":[
                                                "SubnetConfig",
                                                "SubnetA-Values",
                                                "CIDR"
                                        ]
                                },
                                "Tags":[
                                        {
                                                "Key":"Application",
                                                "Value":{
                                                        "Ref":"AWS::StackName"
                                                }
                                        },
                                        {
                                                "Key":"Network",
                                                "Value":"SubnetA"
                                        }
                                ]
                        }
                },
                "SubnetB":{
                        "Type":"AWS::EC2::Subnet",
                        "Properties":{
                                "AvailabilityZone":{
                                        "Fn::FindInMap":[
                                                "SubnetConfig",
                                                "SubnetB-Values",
                                                "AZ"
                                        ]
                                },
                                "VpcId":{
                                        "Ref":"VPC"
                                },
                                "CidrBlock":{
                                        "Fn::FindInMap":[
                                                "SubnetConfig",
                                                "SubnetB-Values",
                                                "CIDR"
                                        ]
                                },
                                "Tags":[
                                        {
                                                "Key":"Application",
                                                "Value":{
                                                        "Ref":"AWS::StackName"
                                                }
                                        },
                                        {
                                                "Key":"Network",
                                                "Value":"SubnetB"
                                        }
                                ]
                        }
                },
                "SubnetC":{
                        "Type":"AWS::EC2::Subnet",
                        "Properties":{
                                "AvailabilityZone":{
                                        "Fn::FindInMap":[
                                                "SubnetConfig",
                                                "SubnetC-Values",
                                                "AZ"
                                        ]
                                },
                                "VpcId":{
                                        "Ref":"VPC"
                                },
                                "CidrBlock":{
                                        "Fn::FindInMap":[
                                                "SubnetConfig",
                                                "SubnetC-Values",
                                                "CIDR"
                                        ]
                                },
                                "Tags":[
                                        {
                                                "Key":"Application",
                                                "Value":{
                                                        "Ref":"AWS::StackName"
                                                }
                                        },
                                        {
                                                "Key":"Network",
                                                "Value":"SubnetC"
                                        }
                                ]
                        }
                },
                "IGW":{
                        "Type":"AWS::EC2::InternetGateway",
                        "Properties":{
                                "Tags":[
                                        {
                                                "Key":"Application",
                                                "Value":{
                                                        "Ref":"AWS::StackName"
                                                }
                                        }
                                ]
                        }
                },
                "igwAttachment":{
                        "Type":"AWS::EC2::VPCGatewayAttachment",
                        "Properties":{
                                "VpcId":{
                                        "Ref":"VPC"
                                },
                                "InternetGatewayId":{
                                        "Ref":"IGW"
                                }
                        }
                },
                "vpcRouteTable":{
                        "Type":"AWS::EC2::RouteTable",
                        "Properties":{
                                "VpcId":{
                                        "Ref":"VPC"
                                },
                                "Tags":[
                                        {
                                                "Key":"Application",
                                                "Value":{
                                                        "Ref":"AWS::StackName"
                                                }
                                        }
                                ]
                        }
                },
                "generalRoute":{
                        "Type":"AWS::EC2::Route",
                        "DependsOn":"igwAttachment",
                        "Properties":{
                                "RouteTableId":{
                                        "Ref":"vpcRouteTable"
                                },
                                "DestinationCidrBlock":"0.0.0.0/0",
                                "GatewayId":{
                                        "Ref":"IGW"
                                }
                        }
                },
                "RouteTableAssociationSubnetA":{
                        "Type":"AWS::EC2::SubnetRouteTableAssociation",
                        "Properties":{
                                "SubnetId":{
                                        "Ref":"SubnetA"
                                },
                                "RouteTableId":{
                                        "Ref":"vpcRouteTable"
                                }
                        }
                },
                "RouteTableAssociationSubnetB":{
                        "Type":"AWS::EC2::SubnetRouteTableAssociation",
                        "Properties":{
                                "SubnetId":{
                                        "Ref":"SubnetB"
                                },
                                "RouteTableId":{
                                        "Ref":"vpcRouteTable"
                                }
                        }
                },
                "RouteTableAssociationSubnetC":{
                        "Type":"AWS::EC2::SubnetRouteTableAssociation",
                        "Properties":{
                                "SubnetId":{
                                        "Ref":"SubnetC"
                                },
                                "RouteTableId":{
                                        "Ref":"vpcRouteTable"
                                }
                        }
                },
                "ACL1":{
                        "Type":"AWS::EC2::NetworkAcl",
                        "Properties":{
                                "VpcId":{
                                        "Ref":"VPC"
                                },
                                "Tags":[
                                        {
                                                "Key":"Application",
                                                "Value":{
                                                        "Ref":"AWS::StackName"
                                                }
                                        }
                                ]
                        }
                },
                "ACLEntryInboundAllTraffic":{
                        "Type":"AWS::EC2::NetworkAclEntry",
                        "Properties":{
                                "NetworkAclId":{
                                        "Ref":"ACL1"
                                },
                                "RuleNumber":"100",
                                "Protocol":"-1",
                                "RuleAction":"allow",
                                "Egress":"false",
                                "CidrBlock":"0.0.0.0/0",
                                "PortRange":{
                                        "From":"0",
                                        "To":"65535"
                                }
                        }
                },
                "ACLEntryOutboundAllTraffic":{
                        "Type":"AWS::EC2::NetworkAclEntry",
                        "Properties":{
                                "NetworkAclId":{
                                        "Ref":"ACL1"
                                },
                                "RuleNumber":"100",
                                "Protocol":"-1",
                                "RuleAction":"allow",
                                "Egress":"true",
                                "CidrBlock":"0.0.0.0/0",
                                "PortRange":{
                                        "From":"0",
                                        "To":"65535"
                                }
                        }
                },
                "ACL1AssociationToSubnetA":{
                        "Type":"AWS::EC2::SubnetNetworkAclAssociation",
                        "Properties":{
                                "SubnetId":{
                                        "Ref":"SubnetA"
                                },
                                "NetworkAclId":{
                                        "Ref":"ACL1"
                                }
                        }
                },
                "ACL1AssociationToSubnetB":{
                        "Type":"AWS::EC2::SubnetNetworkAclAssociation",
                        "Properties":{
                                "SubnetId":{
                                        "Ref":"SubnetB"
                                },
                                "NetworkAclId":{
                                        "Ref":"ACL1"
                                }
                        }
                },
                "ACL1AssociationToSubnetC":{
                        "Type":"AWS::EC2::SubnetNetworkAclAssociation",
                        "Properties":{
                                "SubnetId":{
                                        "Ref":"SubnetC"
                                },
                                "NetworkAclId":{
                                        "Ref":"ACL1"
                                }
                        }
                }
        },
        "Outputs":{
                "id":{
                        "Description":"ID of the newly created VPC",
                        "Value":{
                                "Ref":"VPC"
                        }
                },
                "eu-west-1a":{
                        "Description":"SubnetId of the subnet A",
                        "Value":{
                                "Ref":"SubnetA"
                        }
                },
                "eu-west-1b":{
                        "Description":"SubnetId of the subnet B",
                        "Value":{
                                "Ref":"SubnetB"
                        }
                },
                "eu-west-1c":{
                        "Description":"SubnetId of the subnet C",
                        "Value":{
                                "Ref":"SubnetC"
                        }
                }
        }
}